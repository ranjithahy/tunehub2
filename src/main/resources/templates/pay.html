<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="ISO-8859-1">
  <title>Buy Premium | Tune Hub</title>

  <!-- Razorpay & jQuery -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background-image: url('https://images.unsplash.com/photo-1497032205916-ac775f0649ae?auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }

    .content-container {
      width: 500px;
      margin: 100px auto;
      padding: 30px;
      background: rgba(0, 0, 0, 0.75);
      border-radius: 15px;
      box-shadow: 0 0 15px #00b894;
      text-align: center;
    }

    h1 {
      color: #00cec9;
      margin-bottom: 15px;
    }

    p {
      font-size: 18px;
      margin-bottom: 30px;
    }

    .buy-button {
      padding: 12px 25px;
      background-color: #00cec9;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      color: black;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .buy-button:hover {
      background-color: #00b894;
    }
  </style>
</head>

<body>
  <div class="content-container">
    <h1>Why Go Premium?</h1>
    <p>Access unlimited songs, high-quality playback, and an ad-free experience on Tune Hub.</p>

    <form id="payment-form">
      <button type="submit" class="buy-button">BUY PREMIUM</button>
    </form>
  </div>

  <script>
    $(document).ready(function () {
      $(".buy-button").click(function (e) {
        e.preventDefault();
        createOrder();
      });
    });

    function createOrder() {
      $.post("/createOrder")
        .done(function (order) {
          order = JSON.parse(order);

          var options = {
            "key": "rzp_test_XqtKtnPMD9aBmg",
            "amount": order.amount_due.toString(),
            "currency": "INR",
            "name": "Tune Hub",
            "description": "Premium Membership",
            "order_id": order.id,
            "handler": function (response) {
              verifyPayment(
                response.razorpay_order_id,
                response.razorpay_payment_id,
                response.razorpay_signature
              );
            },
            "prefill": {
              "name": "Your Name",
              "email": "test@example.com",
              "contact": "9999999999"
            },
            "notes": {
              "address": "Your Address"
            },
            "theme": {
              "color": "#00cec9"
            }
          };

          var rzp1 = new Razorpay(options);
          rzp1.open();
        })
        .fail(function (error) {
          console.error("Order creation failed:", error);
        });
    }

    function verifyPayment(orderId, paymentId, signature) {
      $.post("/verify", {
        orderId: orderId,
        paymentId: paymentId,
        signature: signature
      })
        .done(function (isValid) {
          if (isValid === true || isValid === "true") {
            // âœ… Automatically redirect after verification
            window.location.href = "/postPaymentSuccess";
          } else {
            alert("Payment verification failed. Please try again.");
          }
        })
        .fail(function (error) {
          console.error("Verification error:", error);
          alert("An error occurred during verification.");
        });
    }
  </script>
</body>
</html>
